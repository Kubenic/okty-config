name: Nginx
version: 1.13
image: "https://cdn.worldvectorlogo.com/logos/nginx.svg"
docker: nginx
config: 
  - id: general
    label: General
    fields: 
        - id: name 
          label: "Container name"
          type: input
          source: nginx
          destination: docker-compose
          value: container_name
        - id: port 
          label: "Port used on the host machine"
          type: port
          source: "80"
          destination: docker-compose
          value: ports
        - id: application
          label: "Local path to the application"
          type: input
          source: "/var/www/html"
          destination: docker-compose
          value: volumes
    -   id: nginx 
        label: Nginx
        fields:
          - id: max_upload
            label: "Max upload size (Mb)"
            type: input
            source: nginx-config
            destination: file
            value: max_upload_size
files: 
  nginx-server:
    path: '/tmp/nginx.conf'
    content: |
      server {
        listen 80 default;
      
        client_max_body_size {{ max_upload_size | 108M }};
      
        access_log /var/log/nginx/application.access.log;
      
        root /application/public;
        index index.php;
      
        if (!-e $request_filename) {
            rewrite ^.*$ /index.php last;
        }
      
        location ~ \.php$ {
            fastcgi_pass php-fpm:9000;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            fastcgi_param PHP_VALUE "error_log=/var/log/nginx/application_php_errors.log";
            fastcgi_buffers 16 16k;
            fastcgi_buffer_size 32k;
            include fastcgi_params;
        }
      }

